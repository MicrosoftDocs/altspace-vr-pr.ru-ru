---
title: Обзор производительности Алтспацевр Mobile
description: Узнайте, как использовать различные свойства Unity, чтобы обеспечить свою мировую работу на мобильных устройствах, например Окулус Quest.
ms.date: 04/20/2021
ms.topic: article
keywords: Редактор мира, производительность, Окулус, Quest, Unity, текстуры, лигхтмапс, статистика, профилировщик, вызовы Draw, алтспацевр, отправку
ms.openlocfilehash: 9d6afba6fff85adfaa2ba290916f25c84c5377cd
ms.sourcegitcommit: 2db596ab5a1ecd4901a8c893741cc4d06f6aecea
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/25/2021
ms.locfileid: "112961259"
---
# <a name="altspacevr-mobile-performance-guide"></a>Обзор производительности Алтспацевр Mobile

## <a name="main-points"></a>**Основные моменты:**

* **72 кадров** в Окулус 1 и 2 — это целевой объект.
* **Уменьшение числа вызовов рисования через статическую пакетную обработку** является обязательным, целью которого является **менее 25 дравкаллс**
* **Один материал на объект** для поддержки статической пакетной обработки (разбиение объектов с несколькими материалами на отдельные объекты).
* В большинстве случаев **объекты** в среде должны иметь значение **"static"** .
* **Один лигхтмап на сцену**, 1 КБ или 1 КБ для всей сцены, ~ 25 пикселей текстуры на единицу, лигхтмап масштабирование для каждого объекта (масштабирование диаграммы ниже)
* **Используйте шейдеры качества мобильных устройств** (например, "Мобильный/диффузный" и т. д.), чтобы не использовать пробы и лампочки стандартного шейдера Unity/отражения, так как они являются значительными операциями и в случае зондов добавляются вызовы Draw.
* **Треугольники менее 100 КБ** на экране
* **Перекрытияное** исключение может помочь уменьшить многоугольники на экране, хотя есть затраты на предварительное использование перекрытия, чтобы измерить воздействие на частоту кадров в алтспаце с помощью панели диагностика.
* Для всех **текстур** в сцене используйте **"переопределить для Android"** и задайте для них **RGB (a) сжатый АСТК 6x6 блок формата**.  Оставьте для параметров сборки Android сжатие по умолчанию (найдено в: параметры файла/сборки/Android/текстура: "не переопределять"), чтобы Лигхтмапс не АСТК сжатие.  Выполнив приведенные выше действия и совместно используя материалы в объектах, мы пытаемся попытаться разместить в пакете Unity для **Android около 10-20 МБ**.

Общая цель — использовать приемлемую частоту кадров на разных устройствах — в Окулус Quest 1 и 2. в идеале сцена будет выполняться в течение 72 кадров/с со всех точек разных при заполнении сцены, хотя диапазон 60-72 кадров в кадрах часто является более реалистичным целевым объектом.

Частоту кадров можно измерять в Алтспацевр на любом устройстве, которое вы используете (находится в приложении Алтспацевр в разделе **Параметры/поддержка/показывать панель диагностики/кадр/сек**).

Очистка стандартных средств Unity, которые помогут вам лучше оптимизировать сцены:

## <a name="stats-panelframe-debuggerprofiler"></a>**Панель статистики/отладчик кадров/профилировщик**

* Эти средства помогут вашим лучшим друзьям в улучшении производительности сцены.  На них можно **ссылаться только во время воспроизведения сцены в редакторе**, так как их значения будут отличаться от тех, которые не воспроизводятся (т. е. Автоматическое статическое пакетирование не будет происходить, если сцена не воспроизводится).

* **Панель статистики** (просматриваемая в представлении "игра" в разделе "Статистика") показывает объем **сохраненных пакетов/пакетов, вызовов SetPass и частоты кадров**.

    * Пакетов — количество текущих вызовов рисования, видимых с точки зрения текущей камеры.  Более **25 пакетов** для среды является хорошей целью для.
    * Сохраненные пакеты (видны только при воспроизведении сцены) — величину вызовов рисования, которые были сокращены через **статическую пакетную обработку или создание экземпляров GPU** .
    * Вызовы SetPass — число различных видимых материалов в сцене
    * Частота кадров (в секундах) в представлении игры (дает приблизительное представление о том, что происходит). сцены всегда должны тестироваться в приложении, в гарнитуре с помощью панели кадров Окулус, так как она всегда будет отличаться от используемой в редакторе.

* **Отладчик frames** (находится в папке Window/Analysis/Frame Debugger).  Панель статистики на стероидах, если она включена, позволит увидеть, что графический процессор рисует для создания финального изображения, отображая список дравкаллс от первого до последнего.  Это даст вам причины, по которым вызов Draw не был Пакетирован с помощью предыдущего вызова Draw (то есть "Этот объект использует другой материал" или "Этот объект использует другой Лигхтмап") и является отличным способом для разработки понимания того, что происходит в сцене, и как и почему определенные визуальные варианты могут быть ресурсоемкими.

* **Профилировщик** покажет, какие части компьютера используются в любой момент времени во время работы игры. Полезен при определении места снижения производительности.  Например, если вы видите интенсивное использование ЦП в сцене, это может быть вызвано слишком большим количеством вызовов рисования, или если вы видите большой объем использования GPU, то может возникнуть слишком много перерисовок (т. е. Сколько раз один пиксель визуализируется для создания окончательного изображения), что может быть связано с наличием нескольких прозрачных поверхностей. или объекты не исключаются при выходе из представления.

## <a name="draw-calls-shadersmaterialsobjects"></a>**Вызовы Draw (шейдеры, материалы и объекты)**

* Каждый раз, когда шейдер, материал или объект необходимо визуализировать, процессор должен указать GPU коммутатора (также известный как "Draw Calls", разговорной речи **"дравкаллс"**).  То есть, если у вас есть 5 шейдеров, 10 материалов и 20 объектов, в зависимости от того, какое из них является наибольшим; у вас будет около 20 дравкаллс.  Другие вещи, которые могут умножить дравкаллс, включают наличие объектов в разных лигхтмапс или наличие в сцене более одного освещения (т. е. один элемент освещения добавляет еще одну дравкалл к каждому объекту, находящихся в пределах его диапазона), поэтому обычно следует избегать практически любых действий, кроме направленного освещения сцены.  Проверки отражения и легкие проверки также умножают вызовы на объекты, которые они зафиксировали, поэтому их следует избегать.

* **Статическая Пакетная обработка** будет выполнять пакетные объекты, которые совместно используют подобные материалы, в один объект при отправке на GPU (с перекрытия отбора удаленных сеток), поэтому, установив все объекты в приведенном выше примере в значение "static", можно уменьшить сцену до 10 дравкаллс, 1 для каждого материала. 

* **Пакеты материалов** возникают, когда объект имеет точные материалы в виде другого объекта, однако если у объекта есть несколько материалов, он не будет Пакетирован с объектом, который содержит меньше материалов.  По этой причине **объекты должны иметь только 1 материал**, а объекты, использующие несколько материалов, должны разбиваться на отдельные объекты для каждого материала.  **Пакеты материалов** можно уменьшить с помощью **вытягивания текстур** (объединив несколько текстур с несколькими уникальными объектами для совместного использования одной таблицы текстур, чтобы все они использовали один и тот же материал).  Если это возможно, постарайтесь, чтобы объем атласов до одной или более 2000 или 4-кратной текстуры на сцену.

## <a name="scene-complexity"></a>**Сложность сцены**

* **Geometry** — старайтесь не размещать экранные треугольники для сред ниже 100 КБ.  Используйте вкладку "Статистика" на игровом поле Unity, чтобы узнать, какое количество треугольников используется в различных разных точках сцены.  Свойства PROPS должны находиться в диапазоне от "сотни" треугольников, при этом в тысячах диапазонов треугольников должно быть только важное значение "Hero". 

* Технически **Лодс** (уровни детализации) можно использовать, несмотря на то, что решение лигхтмап по умолчанию для Unity не использует данные Лигхтмап между Лодс, поэтому вы можете получить лигхтмаппинг артефакты при этом разрешении.  Кроме того, можно использовать компонент группы Лод для отбора простых расстояний, даже если у объекта нет более низких сеток Лод:

![Окно группы Лод в Unity](images/world-building-lod-Group.png)

* **Отбор перекрытия** сокращает количество объектов, отображаемых только в пределах представления камеры, которые сразу же видимы (то есть объекты, перекрыто из представления, исключаются).  Перекрытияное применение практически всегда должно быть помогутным для сцены, и уровни должны быть спроектированы для поддержки (то есть, если имеется большой уровень, стены или крупные объекты можно использовать для разбиения линейного представления игрока, чтобы они не всегда были видны до противоположного конца уровня.  Параметры внедрить по умолчанию должны работать, хотя может потребоваться сжать значения "наименьшее Окклудер" или "наименьшее отверстие".  Для таких объектов, как границы, где можно увидеть положенное в объекте или прозрачных объектах, следует отключить состояние объекта "Окклудер" в раскрывающемся меню "static", чтобы объекты, находящиеся за ним, не перекрыто по ошибке. 

## <a name="lightmaps"></a>**лигхтмапс**

* В идеале всего **один лигхтмап на сцену** (1 – 2 КБ или 1 КБ для всех), если нет; меньше лигхтмапс более высоких разрешений лучше, чем многие лигхтмапс более низких разрешений.
* Наличие нескольких лигхтмапс может также влиять на количество вызовов Draw, так как объекты, которые либо имеют, либо не имеют лигхтмапс, будут находиться в разных пакетах, а другие лигхтмапс также будут находиться в разных пакетах.
* Как правило, достаточно Лигхтмап разрешение около **25 пикселей текстуры на единицу** (Задание разрешения в параметрах освещения и сцены).  Если у вас есть свободное место в лигхтмап, вы можете увеличить это значение.
* Измените параметр **масштабирования лигхтмап** для объекта таким образом, чтобы разрешение сохранялось для объектов, которым он необходим. 

* **Лигхтмап масштабирование диаграммы** (линейка) 
    * **Передний план** (географический уровень): 1 
    * **PROPS** (особенно PROPS меньше человека): **2-3** (во избежание лигхтмап артефактов и пристыков к объектам). 
    * **Мидграунд** (геометрия, которая находится за пределами области с обходом и (или) больших объектов, например зданий): **0,5**
    * **Фоновый режим** (Vista и удаленные объекты): **0,02** 
    * **Прозрачные поверхности** (например, стекло): **0** (с "приведением и получением теней" отключено) 

Кроме того, в качестве базового уровня ниже приведены некоторые параметры, которые использовались для окружения эффектов двери экрана:

![Окно освещения в Unity](images/world-building-lightmaps.png)

## <a name="texture-compressionfile-size"></a>**Сжатие текстуры/размер файла**

* Для нашей сборки Android мы пытаемся сократить размер сцены пакета Unity примерно до 10-20 МБ.  Это делается путем совместного использования универсальных материалов на множестве объектов, использования цвета вершин для оттенка объектов, а также путем установки переопределений вручную для Android, чтобы текстуры использовали **АСТК 6x6 блочное сжатие**, которое будет меньше, чем сжатие по умолчанию.

* Причина, по которой мы не устанавливаем параметры сборки Android для использования АСТК, заключается в том, что лигхтмапс не выглядят хорошо с этим сжатием (множество артефактов блокировки), и нам пришлось бы установить лигхтмап на использование и т. д. после каждого внедрить, чтобы было проще настроить переопределение для всех текстур сцены по мере обновления параметров сжатия лигхтмап после каждого внедрить.

![Окно текстуры в Unity](images/world-building-texutres.png)

* Кроме того, установка текстур для использования режима фильтрации трилинейной с 2 анизотропным уровнем может помочь им в гланЦинг углы.

Дополнительные советы и рекомендации по повышению производительности можно найти в [документации по повышению производительности в мире](improving-performance.md).